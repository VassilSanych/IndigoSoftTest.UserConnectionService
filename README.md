# IndigoSoftTest.UserConnectionService
# UserConnectionService

## Описание

Сервис предназначен для накопления данных о подключениях пользователей с указанными IP-адресами и предоставления различных способов поиска по этим данным. Сервис сохраняет историю подключений пользователей и обеспечивает возможность эффективного поиска по IP-адресам.

---

## Требования

Сервис должен:
- Накапливать данные о подключении пользователей с IP-адресами.
- Позволять находить пользователей по начальной или полной части IP-адреса.
- Позволять находить все IP-адреса, связанные с определённым пользователем.
- Позволять находить время и IP-адрес последнего подключения пользователя.

---

## Особенности

- **IP-адреса**: Может быть как IPv4, так и IPv6.
- **Дублирование событий**: События могут повторяться, но должны быть обработаны корректно.
- **Гарантия обработки**: Гарантирована обработка каждого события, даже при пиковой нагрузке.
- **Производительность**: Сервис должен выдерживать пиковые нагрузки (до 50 000 пользователей за 30 секунд).

---

## Архитектура

### Технологии
- **Язык программирования**: C#
- **Версия .NET**: 9.0
- **База данных**: PostgreSQL
- **Контейнеризация**: Docker

### Компоненты
1. **API**: Предоставляет RESTful интерфейс для взаимодействия с сервисом.
2. **БД**: Хранит историю подключений пользователей.
3. **Контейнеризация**: Сервис запускается в Docker-контейнере.

---

## Установка

### Предварительные требования
- Docker установлен
- PostgreSQL установлен (или доступен через Docker)

### Запуск

1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/username/UserConnectionService.git
   cd UserConnectionService
   ```
2. Соберите и запустите контейнеры:
   ```bash
   docker-compose up --build
   ```
3. Примените миграции:
   ```bash
   docker exec -it <container_name> dotnet ef database update
   ```
### API
1. Добавление подключения пользователя
POST /api/connection

Параметры :
userId: ID пользователя (long)
ipAddress: IP-адрес пользователя (string)
Пример запроса :
  ```bash
  curl -X POST "http://localhost:5000/api/connection?userId=100001&ipAddress=127.0.0.1"
  ```
Ответ :
{
  "message": "Connection logged successfully"
}

2. Поиск пользователей по части IP-адреса
GET /api/users/by-ip/{partialIp}

Параметры :
partialIp: Частичная строка IP-адреса (string)
Пример запроса :
  ```bash
  curl "http://localhost:5000/api/users/by-ip/31.214"
  ```
Ответ :
[100001, 1234567]

3. Получение всех IP-адресов пользователя
GET /api/users/{userId}/ips

Параметры :
userId: ID пользователя (long)
Пример запроса :
  ```bash
  curl "http://localhost:5000/api/users/100001/ips"
  ```
Ответ :
["127.0.0.1", "31.214.157.141"]

4. Получение последнего подключения пользователя
GET /api/users/{userId}/last-connection

Параметры :
userId: ID пользователя (long)
Пример запроса :
  ```bash
  curl "http://localhost:5000/api/users/100001/last-connection"
  ```
Ответ :
{
  "ipAddress": "31.214.157.141",
  "timestamp": "2024-05-20T14:30:00Z"
}

## Тестирование

### Запуск тестов

  ```bash
  dotnet test
  ```
###  Пример тестов

- Проверка добавления подключения.
- Проверка поиска пользователей по части IP-адреса.
- Проверка получения всех IP-адресов пользователя.
- Проверка получения последнего подключения пользователя.

## Лицензия
Этот проект распространяется под лицензией MIT.

